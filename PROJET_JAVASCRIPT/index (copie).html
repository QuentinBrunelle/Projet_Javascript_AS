<!DOCTYPE html>
<html lang="fr">
    <head>
        <title>Boutique de POP! en ligne </title>
        <meta charset="utf-8"/>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
        <link rel="stylesheet" href="css/style.css"/>
    </head>
    
    <body onload="affichagePrix()">
        <header>
            <nav>
                <ul>
                    <li>Accueil</li>
                    <li>Liste des articles</li>
                    <li>Mon compte</li>
                    <li id="compteur">Mon Panier </li>
                </ul>
            </nav>
        </header>
        
        <section id = "zone_achats">
            <h1 id="titre_liste">Liste des articles</h1>
            <div class="red-divider"></div>
            <div class="row">
                <div id = "produit1" class="col-md-4">
                    <img src="images/pop_hp.jpeg" alt="Harry Potter" class="img_products">
                    <div class="prix_boutons">
                        <div class="button_class">
                            <button onclick="affichageButton(this,0,0)" type="button" class="btn_ajouter" data-nom="Harry Potter" data-prix ="14.90€" data-description="POP! Harry Potter">Ajouter au panier</button>
                            <button onclick="affichageButton(this,0,1)" type="button" class="btn_retirer" data-nom="Harry Potter" data-prix ="14.90€" data-description="POP! Harry Potter">Retirer du panier</button>
                            <p class="prix_article"></p>
                        </div>
                        
                    </div>
                </div>
                
                <div id = "produit2" class="col-md-4">
                    <img src="images/pop_loki.jpg" alt="Loki" class="img_products">
                    <div class="prix_boutons">
                        <div class="button_class">
                            <button onclick="affichageButton(this,1,0)" type="button" class="btn_ajouter" data-nom="Loki" data-prix ="17.90€" data-description="POP! Loki">Ajouter au panier</button>
                            <button onclick="affichageButton(this,1,1)" type="button" class="btn_retirer" data-nom="Loki" data-prix ="17.90€" data-description="POP! Loki">Retirer du panier</button>
                        </div>
                        <p class="prix_article"></p>
                    </div>
                </div>
                
                
                <div id = "produit3" class="col-md-4">
                    <img src="images/pop_spider.jpg" alt="SpiderMan" class="img_products">
                    <div class="prix_boutons">
                        <div class="button_class">
                            <button onclick="affichageButton(this,2,0)" type="button" class="btn_ajouter" data-nom="SpiderMan" data-prix ="25€" data-description="POP! SpiderMan">Ajouter au panier</button>
                            <button onclick="affichageButton(this,2,1)" type="button" class="btn_retirer" data-nom="SpiderMan" data-prix ="25€" data-description="POP! SpiderMan">Retirer du panier</button>
                        </div>
                        <p class="prix_article"></p>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div id = "produit4" class="col-md-4">
                    <img src="images/pop_iron_man.jpg" alt="IronMan" class="img_products">
                    <div class="prix_boutons">
                        <div class="button_class">
                            <button onclick="affichageButton(this,3,0)" type="button" class="btn_ajouter" data-nom="IronMan" data-prix ="14.90€" data-description="POP! IronMan">Ajouter au panier</button>
                            <button onclick="affichageButton(this,3,1)" type="button" class="btn_retirer" data-nom="IronMan" data-prix ="14.90€" data-description="POP! IronMan">Retirer du panier</button>
                            <p class="prix_article"></p>
                        </div>
                        
                    </div>
                </div>
                
                <div id = "produit5" class="col-md-4">
                    <img src="images/pop_freezer.jpg" alt="Freezer" class="img_products">
                    <div class="prix_boutons">
                        <div class="button_class">
                            <button onclick="affichageButton(this,4,0)" type="button" class="btn_ajouter" data-nom="Freezer" data-prix ="17.90€" data-description="POP! Freezer">Ajouter au panier</button>
                            <button onclick="affichageButton(this,4,1)" type="button" class="btn_retirer" data-nom="Freezer" data-prix ="17.90€" data-description="POP! Freezer">Retirer du panier</button>
                        </div>
                        <p class="prix_article"></p>
                    </div>
                </div>
                
                
                <div id = "produit6" class="col-md-4">
                    <img src="images/pop_bmax.jpg" alt="Baymax" class="img_products">
                    <div class="prix_boutons">
                        <div class="button_class">
                            <button onclick="affichageButton(this,5,0)" type="button" class="btn_ajouter" data-nom="Baymax" data-prix ="30€" data-description="POP! Baymax">Ajouter au panier</button>
                            <button onclick="affichageButton(this,5,1)" type="button" class="btn_retirer" data-nom="Baymax" data-prix ="30€" data-description="POP! Baymax">Retirer du panier</button>
                        </div>
                        <p class="prix_article"></p>
                    </div>
                </div>
            </div>
            
        </section>
        
        
        <section id="zone_commande">
            <h1 id="titre_commande">Ma commande</h1>
            <div class="red-divider"></div>
            <div>
                <div class="table-responsive-md">
                    <table class="table table-hover" id="tableau_commande">
                        <thead class="thead-dark">
                            <tr>
                                <th id="description">Description</th>
                                <th id="qte_tableau">Quantité</th>
                                <th id="prix_tableau">Prix</th>
                                <th id="prix_total_tableau">Prix total</th>
                            </tr>
                        </thead>
                        <tbody>

                        </tbody>
                    </table>
                </div>
                <p id="tva_total">TVA A 20% : 0€</p>
                <p id="somme_total">TOTAL : 0€</p>
            </div>
        </section>
        
        <p id="test"></p>
        
        <footer>
        
        </footer>
        
        <script type="text/javascript">
            var tableau_boutons_ajouter = document.getElementsByClassName("btn_ajouter");
            
            /* FONCTION PRINCIPALE 
            *  Permet de changer le type de bouton (Ajouter ou Retirer) et de modifier le tableau de "Ma commande"
            */
            
            function affichageButton(bouton, emplacement_bouton,type_bouton){
                var tableau_boutons_ajouter = document.getElementsByClassName("btn_ajouter");
                var tableau_boutons_retirer = document.getElementsByClassName("btn_retirer");
                var reverse_bouton;
                var test;

                if(type_bouton%2==0){
                    reverse_bouton = tableau_boutons_retirer[emplacement_bouton]; 
                    ajouterLigneTableau(bouton);
                }else{
                    reverse_bouton = tableau_boutons_ajouter[emplacement_bouton];
                    retirerLigneTableau(bouton);
                }    
                
                if(bouton.style.display == "none"){
                    bouton.style.display = "block";
                    reverse_bouton.style.display = "none";
                }else{
                    bouton.style.display = "none";
                    test = reverse_bouton.style.display = "block";
                }
                
                affichageTotal();
                
            }
            
            function affichagePrix(){
                var tableau_tarifs = document.getElementsByClassName("prix_article");
                
                for(let i = 0; i <9; i++){
                    tableau_tarifs[i].innerHTML = $(tableau_boutons_ajouter[i]).data("prix");
                }
            }
            
            /* VARIABLES GLOBALES */
            
            var tableau = document.getElementById("tableau_commande"); 
            var nombre_lignes = 0;
            var somme =0;
            var tva = 0;
            var total_a_payer = 0;
            var compteur = 0;
            var i = 1;
            
            function ajouterLigneTableau(donnees){
                
                var nouvelle_ligne = tableau.insertRow(-1);
                 
                var colonne_une = nouvelle_ligne.insertCell(0);
                colonne_une.innerHTML = $(donnees).data("description");
				
                var colonne_deux = nouvelle_ligne.insertCell(1);
				
                var saisie_quantite = document.createElement("input");
                saisie_quantite.setAttribute("type","text");
                saisie_quantite.setAttribute("name","saisie_quantite");
                saisie_quantite.setAttribute("class","saisie_quantite");
                saisie_quantite.setAttribute("size","10px");
                saisie_quantite.setAttribute("onchange","changementQuantite()")
                saisie_quantite.value = "1";
                colonne_deux.appendChild(saisie_quantite);
                
 
                var colonne_trois = nouvelle_ligne.insertCell(2);
                colonne_trois.innerHTML = $(donnees).data("prix");
                
                var colonne_quatre = nouvelle_ligne.insertCell(3);
                colonne_quatre.innerHTML = $(donnees).data("prix");
                
                nombre_lignes++;
            }
            
            function retirerLigneTableau(bouton){
                var longueur = tableau.length;
                i=1;
                
                while(i<9){					
					if((tableau.rows[i].cells[0].innerHTML) == ($(bouton).data("description"))){
						tableau.deleteRow(i);
                        nombre_lignes--;
						return true;
					}
					i++;
				}
            }
            
            function changementQuantite(){          
                i=1;
                somme=0;
                
                var element = document.getElementsByClassName("saisie_quantite");
                
                while(i<=nombre_lignes){    
					
					if(element[i-1].value >= 11 || element[i-1].value <=0){
						tableau.rows[i].cells[3].innerHTML = "Quantité entre 1 et 10";
					}else{
                        var tarif_produit = parseFloat(tableau.rows[i].cells[2].innerHTML);
                        
                        tableau.rows[i].cells[3].innerHTML =  element[i-1].value * Math.round(tarif_produit*100)/100+"€"; 
                        
                       /* var prix_total = parseFloat(tableau.rows[i].cells[3].innerHTML);
                        if(prix_total.innerHTML == "Quantité entre 1 et 10"){}
                        else{somme += Math.round(prix_total*100)/100;}*/
                    }
                    i++;
                }
                
                affichageTotal();
                /*tva=somme*0.2;
                total_a_payer = somme + tva;
                document.getElementById("tva_total").innerHTML = "TVA A 20% : " + Math.round(tva*100)/100 + "€";
                document.getElementById("somme_total").innerHTML = "TOTAL A PAYER : " + Math.round(total_a_payer*100)/100  + "€";   */        
            }
            
            function affichageTotal(){
                i = 1;
                somme = 0;
                tva = 0;
                total_a_payer = 0;
                
                if(nombre_lignes==0){
                    document.getElementById("somme_total").innerHTML = "TOTAL A PAYER : " + somme; 
                }

                while(i<=nombre_lignes){
                    var tarif_produits2 = parseFloat(tableau.rows[i].cells[3].innerHTML);
                    
                    document.getElementById("test").innerHTML += i + " : " + tableau.rows[i].cells[3].innerHTML + "</br>";
                    
                    if(tarif_produits2.innerHTML == "Quantité entre 1 et 10"){}
                    else{somme += Math.round(tarif_produits2*100)/100;}
                    i++;
                }
                
                tva=somme*0.2;
                total_a_payer = somme + tva;
                document.getElementById("tva_total").innerHTML = "TVA A 20% : " + Math.round(tva*100)/100 + "€";
                document.getElementById("somme_total").innerHTML = "TOTAL A PAYER : " + Math.round(total_a_payer*100)/100 + "€";
                
            }
            
            /*function affichageCompteur(){
                i=1;
                compteur = 0;
                while(i<=nombre_lignes){
                    compteur += element[i-1].value
                    i++;
                }
                 document.getElementById("compteur").innerHTML = "Mon panier : " +compteur + " article(s)";
                 document.getElementById("test").innerHTML = compteur;
                return true;  
            }*/
            
        </script>
    </body>
</html>
